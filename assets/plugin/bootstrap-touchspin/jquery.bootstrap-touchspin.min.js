!function (t) {
    "function" == typeof define && define.amd ? define(["jquery"], t) : "object" == typeof module && module.exports ? module.exports = function (n, o) {
        return void 0 === o && (o = "undefined" != typeof window ? require("jquery") : require("jquery")(n)), t(o), o
    } : t(jQuery)
}(function (t) {
    "use strict";
    var n = 0;
    t.fn.TouchSpin = function (o) {
        var s = {
            min: 0,
            max: 100,
            initval: "",
            replacementval: "",
            firstclickvalueifempty: null,
            step: 1,
            decimals: 0,
            stepinterval: 100,
            forcestepdivisibility: "round",
            stepintervaldelay: 500,
            verticalbuttons: !1,
            verticalup: "+",
            verticaldown: "-",
            verticalupclass: "",
            verticaldownclass: "",
            prefix: "",
            postfix: "",
            prefix_extraclass: "",
            postfix_extraclass: "",
            booster: !0,
            boostat: 10,
            maxboostedstep: !1,
            mousewheel: !0,
            buttondown_class: "btn btn-primary",
            buttonup_class: "btn btn-primary",
            buttondown_txt: "-",
            buttonup_txt: "+",
            callback_before_calculation: function (t) {
                return t
            },
            callback_after_calculation: function (t) {
                return t
            }
        }, p = {
            min: "min",
            max: "max",
            initval: "init-val",
            replacementval: "replacement-val",
            firstclickvalueifempty: "first-click-value-if-empty",
            step: "step",
            decimals: "decimals",
            stepinterval: "step-interval",
            verticalbuttons: "vertical-buttons",
            verticalupclass: "vertical-up-class",
            verticaldownclass: "vertical-down-class",
            forcestepdivisibility: "force-step-divisibility",
            stepintervaldelay: "step-interval-delay",
            prefix: "prefix",
            postfix: "postfix",
            prefix_extraclass: "prefix-extra-class",
            postfix_extraclass: "postfix-extra-class",
            booster: "booster",
            boostat: "boostat",
            maxboostedstep: "max-boosted-step",
            mousewheel: "mouse-wheel",
            buttondown_class: "button-down-class",
            buttonup_class: "button-up-class",
            buttondown_txt: "button-down-txt",
            buttonup_txt: "button-up-txt"
        };
        return this.each(function () {
            function a() {
                "" === b.prefix && (h = g.prefix.detach()), "" === b.postfix && (v = g.postfix.detach())
            }

            function e() {
                var t, n, o;
                "" !== (t = b.callback_before_calculation(C.val())) ? 0 < b.decimals && "." === t || (n = parseFloat(t), isNaN(n) && (n = "" !== b.replacementval ? b.replacementval : 0), (o = n).toString() !== t && (o = n), null !== b.min && n < b.min && (o = b.min), null !== b.max && n > b.max && (o = b.max), o = function (t) {
                    switch (b.forcestepdivisibility) {
                        case"round":
                            return (Math.round(t / b.step) * b.step).toFixed(b.decimals);
                        case"floor":
                            return (Math.floor(t / b.step) * b.step).toFixed(b.decimals);
                        case"ceil":
                            return (Math.ceil(t / b.step) * b.step).toFixed(b.decimals);
                        default:
                            return t.toFixed(b.decimals)
                    }
                }(o), Number(t).toString() !== o.toString() && (C.val(o), C.trigger("change"))) : "" !== b.replacementval && (C.val(b.replacementval), C.trigger("change"))
            }

            function i() {
                if (b.booster) {
                    var t = Math.pow(2, Math.floor(D / b.boostat)) * b.step;
                    return b.maxboostedstep && t > b.maxboostedstep && (t = b.maxboostedstep, m = Math.round(m / t) * t), Math.max(b.step, t)
                }
                return b.step
            }

            function u() {
                return "number" == typeof b.firstclickvalueifempty ? b.firstclickvalueifempty : (b.min + b.max) / 2
            }

            function r() {
                e();
                var t, n = m = parseFloat(b.callback_before_calculation(g.input.val()));
                isNaN(m) ? m = u() : (t = i(), m += t), null !== b.max && m > b.max && (m = b.max, C.trigger("touchspin.on.max"), f()), g.input.val(b.callback_after_calculation(Number(m).toFixed(b.decimals))), n !== m && C.trigger("change")
            }

            function c() {
                e();
                var t, n = m = parseFloat(b.callback_before_calculation(g.input.val()));
                isNaN(m) ? m = u() : (t = i(), m -= t), null !== b.min && m < b.min && (m = b.min, C.trigger("touchspin.on.min"), f()), g.input.val(b.callback_after_calculation(Number(m).toFixed(b.decimals))), n !== m && C.trigger("change")
            }

            function l() {
                f(), D = 0, N = "down", C.trigger("touchspin.on.startspin"), C.trigger("touchspin.on.startdownspin"), y = setTimeout(function () {
                    w = setInterval(function () {
                        D++, c()
                    }, b.stepinterval)
                }, b.stepintervaldelay)
            }

            function d() {
                f(), D = 0, N = "up", C.trigger("touchspin.on.startspin"), C.trigger("touchspin.on.startupspin"), k = setTimeout(function () {
                    _ = setInterval(function () {
                        D++, r()
                    }, b.stepinterval)
                }, b.stepintervaldelay)
            }

            function f() {
                switch (clearTimeout(y), clearTimeout(k), clearInterval(w), clearInterval(_), N) {
                    case"up":
                        C.trigger("touchspin.on.stopupspin"), C.trigger("touchspin.on.stopspin");
                        break;
                    case"down":
                        C.trigger("touchspin.on.stopdownspin"), C.trigger("touchspin.on.stopspin")
                }
                D = 0, N = !1
            }

            var b, h, v, x, g, m, w, _, y, k, C = t(this), j = C.data(), D = 0, N = !1;
            !function () {
                var i, u;
                if (!C.data("alreadyinitialized")) C.data("alreadyinitialized", !0), n += 1, C.data("spinnerid", n), C.is("input") ? (b = t.extend({}, s, j, function () {
                    var n = {};
                    return t.each(p, function (t, o) {
                        var s = "bts-" + o;
                        C.is("[data-" + s + "]") && (n[t] = C.data(s))
                    }), n
                }(), o), "" !== b.initval && "" === C.val() && C.val(b.initval), e(), i = C.val(), u = C.parent(), "" !== i && (i = b.callback_after_calculation(Number(i).toFixed(b.decimals))), C.data("initvalue", i).val(i), C.addClass("form-counter"), u.hasClass("input-group") ? function (n) {
                    n.addClass("bootstrap-touchspin");
                    var o, s, p = C.prev(), a = C.next(),
                        e = '<span class="input-group-addon input-group-prepend bootstrap-touchspin-prefix input-group-prepend bootstrap-touchspin-injected"><span class="input-group-text">' + b.prefix + "</span></span>",
                        i = '<span class="input-group-addon input-group-append bootstrap-touchspin-postfix input-group-append bootstrap-touchspin-injected"><span class="input-group-text">' + b.postfix + "</span></span>";
                    p.hasClass("input-group-btn") || p.hasClass("input-group-prepend") ? (o = '<button class="' + b.buttondown_class + ' bootstrap-touchspin-down bootstrap-touchspin-injected" type="button">' + b.buttondown_txt + "</button>", p.append(o)) : (o = '<span class="input-group-btn input-group-prepend bootstrap-touchspin-injected"><button class="' + b.buttondown_class + ' bootstrap-touchspin-down" type="button">' + b.buttondown_txt + "</button></span>", t(o).insertBefore(C)), a.hasClass("input-group-btn") || a.hasClass("input-group-append") ? (s = '<button class="' + b.buttonup_class + ' bootstrap-touchspin-up bootstrap-touchspin-injected" type="button">' + b.buttonup_txt + "</button>", a.prepend(s)) : (s = '<span class="input-group-btn input-group-append bootstrap-touchspin-injected"><button class="' + b.buttonup_class + ' bootstrap-touchspin-up" type="button">' + b.buttonup_txt + "</button></span>", t(s).insertAfter(C)), t(e).insertBefore(C), t(i).insertAfter(C), x = n
                }(u) : function () {
                    var n, o = "";
                    C.hasClass("input-sm") && (o = "input-group-sm"), C.hasClass("input-lg") && (o = "input-group-lg"), n = b.verticalbuttons ? '<div class="input-group ' + o + ' bootstrap-touchspin bootstrap-touchspin-injected"><span class="input-group-addon input-group-prepend bootstrap-touchspin-prefix"><span class="input-group-text">' + b.prefix + '</span></span><span class="input-group-addon bootstrap-touchspin-postfix input-group-append"><span class="input-group-text">' + b.postfix + '</span></span><span class="input-group-btn-vertical"><button class="' + b.buttondown_class + " bootstrap-touchspin-up " + b.verticalupclass + '" type="button">' + b.verticalup + '</button><button class="' + b.buttonup_class + " bootstrap-touchspin-down " + b.verticaldownclass + '" type="button">' + b.verticaldown + "</button></span></div>" : '<div class="input-group bootstrap-touchspin bootstrap-touchspin-injected"><span class="input-group-btn input-group-prepend"><button class="' + b.buttondown_class + ' bootstrap-touchspin-down" type="button">' + b.buttondown_txt + '</button></span><span class="input-group-addon bootstrap-touchspin-prefix input-group-prepend"><span class="input-group-text">' + b.prefix + '</span></span><span class="input-group-addon bootstrap-touchspin-postfix input-group-append"><span class="input-group-text">' + b.postfix + '</span></span><span class="input-group-btn input-group-append"><button class="' + b.buttonup_class + ' bootstrap-touchspin-up" type="button">' + b.buttonup_txt + "</button></span></div>", x = t(n).insertBefore(C), t(".bootstrap-touchspin-prefix", x).after(C), C.hasClass("input-sm") ? x.addClass("input-group-sm") : C.hasClass("input-lg") && x.addClass("input-group-lg")
                }(), g = {
                    down: t(".bootstrap-touchspin-down", x),
                    up: t(".bootstrap-touchspin-up", x),
                    input: t("input", x),
                    prefix: t(".bootstrap-touchspin-prefix", x).addClass(b.prefix_extraclass),
                    postfix: t(".bootstrap-touchspin-postfix", x).addClass(b.postfix_extraclass)
                }, a(), C.on("keydown.touchspin", function (t) {
                    var n = t.keyCode || t.which;
                    38 === n ? ("up" !== N && (r(), d()), t.preventDefault()) : 40 === n && ("down" !== N && (c(), l()), t.preventDefault())
                }), C.on("keyup.touchspin", function (t) {
                    var n = t.keyCode || t.which;
                    38 !== n && 40 !== n || f()
                }), C.on("blur.touchspin", function () {
                    e(), C.val(b.callback_after_calculation(C.val()))
                }), g.down.on("keydown", function (t) {
                    var n = t.keyCode || t.which;
                    32 !== n && 13 !== n || ("down" !== N && (c(), l()), t.preventDefault())
                }), g.down.on("keyup.touchspin", function (t) {
                    var n = t.keyCode || t.which;
                    32 !== n && 13 !== n || f()
                }), g.up.on("keydown.touchspin", function (t) {
                    var n = t.keyCode || t.which;
                    32 !== n && 13 !== n || ("up" !== N && (r(), d()), t.preventDefault())
                }), g.up.on("keyup.touchspin", function (t) {
                    var n = t.keyCode || t.which;
                    32 !== n && 13 !== n || f()
                }), g.down.on("mousedown.touchspin", function (t) {
                    g.down.off("touchstart.touchspin"), C.is(":disabled") || (c(), l(), t.preventDefault(), t.stopPropagation())
                }), g.down.on("touchstart.touchspin", function (t) {
                    g.down.off("mousedown.touchspin"), C.is(":disabled") || (c(), l(), t.preventDefault(), t.stopPropagation())
                }), g.up.on("mousedown.touchspin", function (t) {
                    g.up.off("touchstart.touchspin"), C.is(":disabled") || (r(), d(), t.preventDefault(), t.stopPropagation())
                }), g.up.on("touchstart.touchspin", function (t) {
                    g.up.off("mousedown.touchspin"), C.is(":disabled") || (r(), d(), t.preventDefault(), t.stopPropagation())
                }), g.up.on("mouseup.touchspin mouseout.touchspin touchleave.touchspin touchend.touchspin touchcancel.touchspin", function (t) {
                    N && (t.stopPropagation(), f())
                }), g.down.on("mouseup.touchspin mouseout.touchspin touchleave.touchspin touchend.touchspin touchcancel.touchspin", function (t) {
                    N && (t.stopPropagation(), f())
                }), g.down.on("mousemove.touchspin touchmove.touchspin", function (t) {
                    N && (t.stopPropagation(), t.preventDefault())
                }), g.up.on("mousemove.touchspin touchmove.touchspin", function (t) {
                    N && (t.stopPropagation(), t.preventDefault())
                }), C.on("mousewheel.touchspin DOMMouseScroll.touchspin", function (t) {
                    if (b.mousewheel && C.is(":focus")) {
                        var n = t.originalEvent.wheelDelta || -t.originalEvent.deltaY || -t.originalEvent.detail;
                        t.stopPropagation(), t.preventDefault(), (n < 0 ? c : r)()
                    }
                }), C.on("touchspin.destroy", function () {
                    var n;
                    n = C.parent(), f(), C.off(".touchspin"), n.hasClass("bootstrap-touchspin-injected") ? (C.siblings().remove(), C.unwrap()) : (t(".bootstrap-touchspin-injected", n).remove(), n.removeClass("bootstrap-touchspin")), C.data("alreadyinitialized", !1)
                }), C.on("touchspin.uponce", function () {
                    f(), r()
                }), C.on("touchspin.downonce", function () {
                    f(), c()
                }), C.on("touchspin.startupspin", function () {
                    d()
                }), C.on("touchspin.startdownspin", function () {
                    l()
                }), C.on("touchspin.stopspin", function () {
                    f()
                }), C.on("touchspin.updatesettings", function (n, o) {
                    !function (n) {
                        (function (n) {
                            b = t.extend({}, b, n), n.postfix && (0 === C.parent().find(".bootstrap-touchspin-postfix").length && v.insertAfter(C), C.parent().find(".bootstrap-touchspin-postfix .input-group-text").text(n.postfix)), n.prefix && (0 === C.parent().find(".bootstrap-touchspin-prefix").length && h.insertBefore(C), C.parent().find(".bootstrap-touchspin-prefix .input-group-text").text(n.prefix)), a()
                        })(n), e();
                        var o = g.input.val();
                        "" !== o && (o = Number(b.callback_before_calculation(g.input.val())), g.input.val(b.callback_after_calculation(Number(o).toFixed(b.decimals))))
                    }(o)
                })) : console.log("Must be an input.")
            }()
        })
    }
});